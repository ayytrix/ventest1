<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Venux - Friend Requests</title>
<style>
body { 
  margin:0; 
  font-family:Arial,sans-serif; 
  background:#d4d4d4; 
  color:#222; 
  font-size:13px; 
  min-height:100vh;
}
#main-header {
  background:linear-gradient(to bottom,#1a4a84 0%,#0b2c5a 100%);
  padding:10px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
#main-header img { height:52px; object-fit:contain; }
.nav-links a {
  color:white;
  text-decoration:none;
  margin-right:15px;
  font-weight:bold;
}
.nav-links a:hover { text-decoration:underline; }
#page-content { padding:20px; max-width:800px; margin:auto; }
.friend-request { 
  background:#fff; 
  padding:10px; 
  margin-bottom:10px; 
  border:1px solid #999; 
  display:flex; 
  justify-content:space-between; 
  align-items:center; 
  border-radius:4px; 
}
.friend-request button { 
  margin-left:5px; 
  padding:4px 8px; 
  cursor:pointer; 
}
#footer {
  text-align:center;
  font-size:12px;
  color:#444;
  padding:10px;
  border-top:2px solid #999;
  background:linear-gradient(to bottom,#f3f3f3 0%,#d8d8d8 100%);
  margin-top:40px;
}
</style>
</head>
<body>

<div id="main-header">
  <img src="https://raw.githubusercontent.com/ayytrix/ventest1/refs/heads/main/venux.png" alt="Venux">
  <div class="nav-links">
    <a href="Home.html">Home</a>
    <a href="Profile.html">Profile</a>
    <a href="FriendRequests.html">Friend Requests</a>
    <a href="Help.html">Help</a>
  </div>
</div>

<div id="page-content">
  <h2>Friend Requests</h2>
  <div id="requestList">Loading...</div>
</div>

<div id="footer">Â© 2025, Venux All rights reserved</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBPmJ-QYXZ41gx-4PjCpUPuw7DLnDq0JFg",
  authDomain: "venux1.firebaseapp.com",
  projectId: "venux1",
  storageBucket: "venux1.appspot.com",
  messagingSenderId: "231055963335",
  appId: "1:231055963335:web:34c2f52fca2191b3d0bae2",
  measurementId: "G-N36RRV95SW"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const requestList = document.getElementById("requestList");

onAuthStateChanged(auth, async (user)=>{
  if(!user){ window.location.href="Login.html"; return; }

  const userRef = doc(db,"users",user.uid);
  const userSnap = await getDoc(userRef);
  if(!userSnap.exists()){ requestList.textContent = "No data found."; return; }

  const userData = userSnap.data();
  const requests = userData.friendRequests || [];

  requestList.innerHTML = "";

  if(requests.length === 0){
    requestList.textContent = "No pending friend requests.";
    return;
  }

  for(const requesterUid of requests){
    const requesterSnap = await getDoc(doc(db,"users",requesterUid));
    if(!requesterSnap.exists()) continue;

    const requesterData = requesterSnap.data();

    const div = document.createElement("div");
    div.className = "friend-request";
    div.textContent = requesterData.username || "Unknown User";

    const acceptBtn = document.createElement("button");
    acceptBtn.textContent = "Accept";
    acceptBtn.addEventListener("click", async ()=>{
      // Add each other as friends
      await setDoc(doc(db,"users",user.uid), {
        friends: [...(userData.friends||[]), requesterUid],
        friendRequests: (userData.friendRequests||[]).filter(id => id!==requesterUid)
      }, {merge:true});

      await setDoc(doc(db,"users",requesterUid), {
        friends: [...(requesterData.friends||[]), user.uid]
      }, {merge:true});

      div.remove();
    });

    const declineBtn = document.createElement("button");
    declineBtn.textContent = "Decline";
    declineBtn.addEventListener("click", async ()=>{
      await setDoc(doc(db,"users",user.uid), {
        friendRequests: (userData.friendRequests||[]).filter(id => id!==requesterUid)
      }, {merge:true});
      div.remove();
    });

    div.appendChild(acceptBtn);
    div.appendChild(declineBtn);
    requestList.appendChild(div);
  }
});
</script>

</body>
</html>
