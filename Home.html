<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Venux - Home</title>
<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:#d4d4d4;
  color:#222;
  font-size:13px;
  display:flex;
  flex-direction:column;
  min-height:100vh;
}
#main-header{
  background:linear-gradient(to bottom,#1a4a84 0%,#0b2c5a 100%);
  padding:10px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
#main-header img{ height:52px; object-fit:contain; }
.auth-buttons{ display:flex; align-items:center; gap:10px; color:white; }
.logout-btn{ padding:8px 15px; border:none; border-radius:4px; font-weight:bold; cursor:pointer; font-size:12px; background:linear-gradient(to bottom,#f44336 0%,#da190b 100%); color:white; transition: all 0.3s ease; }
.logout-btn:hover{ background:linear-gradient(to bottom,#da190b 0%,#f44336 100%); }
#sub-header{ background:linear-gradient(to bottom,#1a4a84 0%,#0b2c5a 100%); padding:8px 15px; border-bottom:1px solid #000000; }
#sub-header a{ color:white; text-decoration:none; margin:0 10px 0 0; font-weight:bold; padding:6px 10px; border-radius:4px; transition: all 0.3s ease; }
#sub-header a:hover{ background:linear-gradient(to bottom,#1f5da0 0%,#0e3670 100%); }
.nav-separator{ color:white; margin:0 10px 0 0; }
#notice{ background:linear-gradient(to bottom,#ffa200 0%,#cc7a00 100%); color:white; padding:10px 20px; font-weight:bold; text-align:center; border-bottom:2px solid #a85f00; }
#page-content{ flex:1; padding:20px; display:flex; flex-direction:column; gap:20px; position:relative; }
#profile-frame{ display:flex; flex-direction:column; align-items:center; gap:10px; position:relative; z-index:1; }
#avatar-frame{ width:150px; height:150px; background:#ccc; border:2px solid #999; }
#profile-username{ font-weight:bold; font-size:20px; }
#profile-buttons{ display:flex; gap:10px; }
.button, .friend-btn, .accept-btn, .decline-btn{ padding:6px 12px; border:none; border-radius:4px; font-weight:bold; cursor:pointer; color:white; transition: all 0.3s ease; }
.friend-btn{ background:#1a73e8; }
.friend-btn:disabled{ background:#555; cursor:not-allowed; }
.accept-btn{ background:green; }
.decline-btn{ background:red; }
.news-box{ background:linear-gradient(to bottom,#fff 0%,#e2e2e2 100%); border:2px solid #999; padding:12px; box-shadow:2px 2px 0 #aaa; position:relative; z-index:2; }
.news-title{ font-weight:bold; font-size:14px; margin-bottom:6px; }
.news-date{ font-size:11px; color:#666; margin-bottom:10px; }
.news-body{ font-size:13px; }
.friend-requests-frame{ display:none; flex-direction:column; gap:10px; border:2px solid #999; padding:10px; background:#fff; }
#footer{ text-align:center; font-size:12px; color:#444; padding:10px; border-top:2px solid #999; background:linear-gradient(to bottom,#f3f3f3 0%,#d8d8d8 100%); margin-top:auto; }
</style>
</head>
<body>

<div id="main-header">
  <img src="https://raw.githubusercontent.com/ayytrix/ventest1/refs/heads/main/venux.png" alt="Venux">
  <div class="auth-buttons" id="authButtons"></div>
</div>

<div id="sub-header">
  <a href="Home">Home</a><span class="nav-separator">|</span>
  <a href="Games">Games</a><span class="nav-separator">|</span>
  <a href="Catalog">Catalog</a><span class="nav-separator">|</span>
  <a href="Users">Users</a><span class="nav-separator">|</span>
  <a href="Forums">Forum</a><span class="nav-separator">|</span>
  <a href="Clans">Clans</a><span class="nav-separator">|</span>
  <a href="Help">Help</a><span class="nav-separator">|</span>
  <a href="Downloads">Downloads</a><span class="nav-separator">|</span>
  <a href="Create">Create</a>
</div>

<div id="notice">Loading...</div>

<div id="page-content">
  <!-- Profile Frame Section -->
  <div id="profile-frame">
    <div id="avatar-frame"></div>
    <div id="profile-username"></div>
    <div id="profile-buttons">
      <button class="button" id="goProfileBtn">Go to Profile</button>
      <button class="friend-btn" id="friendBtn"></button>
      <button class="friend-btn" id="incomingBtn">Incoming Friend Requests (0)</button>
    </div>
    <div class="friend-requests-frame" id="friendRequestsFrame"></div>
  </div>

  <!-- News Section -->
  <div id="news-section">
    <h2>Latest News</h2>
    <div class="news-box">
      <div class="news-title">Welcome to Venux!</div>
      <div class="news-date">Posted: 8th October, 2025</div>
      <div class="news-body">This is for news happening in Venux!</div>
    </div>
    <div class="news-box">
      <div class="news-title">Update Log</div>
      <div class="news-date">Posted: 17th October, 2025</div>
      <div class="news-body">
        - Check out our new status site, at <a href="https://status.venux.fun" target="_blank">status.venux.fun</a><br>
        - Added more pages
      </div>
    </div>
  </div>
</div>

<div id="footer">© 2025, Venux — All rights reserved</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
import { getFirestore, doc, getDoc, collection, getDocs, setDoc, serverTimestamp, deleteDoc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBPmJ-QYXZ41gx-4PjCpUPuw7DLnDq0JFg",
  authDomain: "venux1.firebaseapp.com",
  projectId: "venux1",
  storageBucket: "venux1.appspot.com",
  messagingSenderId: "231055963335",
  appId: "1:231055963335:web:34c2f52fca2191b3d0bae2",
  measurementId: "G-N36RRV95SW"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const noticeBar = document.getElementById("notice");
const authButtons = document.getElementById("authButtons");
const profileUsername = document.getElementById("profile-username");
const goProfileBtn = document.getElementById("goProfileBtn");
const friendBtn = document.getElementById("friendBtn");
const incomingBtn = document.getElementById("incomingBtn");
const friendRequestsFrame = document.getElementById("friendRequestsFrame");

// Dynamic banner
let dynamicNotice = "Welcome to Venux!";
fetch("https://raw.githubusercontent.com/ayytrix/ventest1/refs/heads/main/anc")
  .then(r => r.ok ? r.text() : dynamicNotice)
  .then(t => { dynamicNotice = t; noticeBar.textContent = t; })
  .catch(() => noticeBar.textContent = dynamicNotice);

onAuthStateChanged(auth, async (user)=>{
  if(!user) return window.location.href="Login.html";
  const userDocRef = doc(db,"users",user.uid);
  const userSnap = await getDoc(userDocRef);
  const username = userSnap.exists() ? userSnap.data().username : "User";

  authButtons.innerHTML = `<span>Welcome, ${username}</span> <button class="logout-btn" id="logoutBtn">Logout</button>`;
  document.getElementById("logoutBtn").addEventListener("click", async ()=>{
    await signOut(auth);
    window.location.href="Login.html";
  });

  profileUsername.textContent = username;

  goProfileBtn.onclick = ()=>window.location.href=`Profile?userId=${userSnap.data().userId || user.uid}`;

  // Friend requests
  async function updateFriendRequests(){
    const frArray = userSnap.exists() ? (userSnap.data().friendRequests || []) : [];
    incomingBtn.textContent = `Incoming Friend Requests (${frArray.length})`;
    friendRequestsFrame.innerHTML = "";
    if(frArray.length > 0){
      for(const fr of frArray){
        const frDoc = await getDoc(doc(db,"users",fr));
        if(!frDoc.exists()) continue;
        const frUsername = frDoc.data().username || "User";
        const frDiv = document.createElement("div");
        frDiv.innerHTML = `<strong class="fr-username" style="cursor:pointer;">${frUsername}</strong>`;
        const acceptBtn = document.createElement("button");
        acceptBtn.className="accept-btn";
        acceptBtn.textContent="Accept";
        const declineBtn = document.createElement("button");
        declineBtn.className="decline-btn";
        declineBtn.textContent="Decline";

        frDiv.appendChild(acceptBtn);
        frDiv.appendChild(declineBtn);
        friendRequestsFrame.appendChild(frDiv);

        frDiv.querySelector(".fr-username").onclick = ()=>window.location.href=`Profile?userId=${frDoc.data().userId}`;

        acceptBtn.onclick = async ()=>{
          // Add each other as friends
          const currentUserData = userSnap.data();
          const frData = frDoc.data();
          const currentFriends = currentUserData.friends || [];
          const frFriends = frData.friends || [];
          if(!currentFriends.includes(frDoc.id)) currentFriends.push(frDoc.id);
          if(!frFriends.includes(user.uid)) frFriends.push(user.uid);
          await setDoc(userDocRef, {...currentUserData, friends: currentFriends, friendRequests: currentFriends.filter(f=>f!==frDoc.id)}, {merge:true});
          await setDoc(doc(db,"users",frDoc.id), {...frData, friends: frFriends}, {merge:true});
          updateFriendRequests();
        };

        declineBtn.onclick = async ()=>{
          const currentUserData = userSnap.data();
          const newFR = (currentUserData.friendRequests||[]).filter(f=>f!==frDoc.id);
          await setDoc(userDocRef, {...currentUserData, friendRequests:newFR}, {merge:true});
          updateFriendRequests();
        };
      }
    }
  }
  incomingBtn.onclick = ()=>{
    friendRequestsFrame.style.display = friendRequestsFrame.style.display==="flex"?"none":"flex";
  };
  updateFriendRequests();
});
</script>

</body>
</html>
