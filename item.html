<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Venux - Item</title>
<link rel="icon" type="image/png" href="https://raw.githubusercontent.com/ayytrix/ventest1/refs/heads/main/venux.png">
<style>
body{margin:0;font-family:Arial,sans-serif;background:#f2f2f2;color:#222;}
#main-header,#sub-header{padding:10px 20px;background:linear-gradient(to bottom,#1a4a84 0%,#0b2c5a 100%);}
#main-header img{height:52px;}
#sub-header a{color:white;text-decoration:none;margin-right:20px;font-weight:bold;}
#sub-header a:hover{text-decoration:underline;}
#notice{background:linear-gradient(to bottom,#ffa200 0%,#cc7a00 100%);color:white;padding:10px 20px;font-weight:bold;text-align:center;}
#page-content{padding:20px;}
.item-view{display:flex;gap:20px;margin-top:20px;}
.item-view img{width:128px;height:128px;image-rendering:pixelated;}
.item-info h2{margin:0;}
.item-info p{margin:5px 0;}
button{padding:10px 15px;background:#1a4a84;color:white;border:none;border-radius:4px;font-weight:bold;cursor:pointer;}
button:hover{background:#255da3;}
#footer{text-align:center;font-size:12px;color:#444;padding:10px;border-top:2px solid #999;background:linear-gradient(to bottom,#f3f3f3 0%,#d8d8d8 100%);margin-top:40px;}
</style>
</head>
<body>

<div id="main-header"><img src="https://raw.githubusercontent.com/ayytrix/ventest1/refs/heads/main/venux.png" alt="Venux"></div>
<div id="sub-header">
<a href="Home.html">Home</a>
<a href="Games.html">Games</a>
<a href="Catalog.html">Catalog</a>
<a href="Users.html">Users</a>
<a href="Forums.html">Forum</a>
</div>
<div id="notice">Loading...</div>
<div id="page-content"></div>
<div id="footer">© 2025, Venux — All rights reserved</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";

const firebaseConfig = {
apiKey:"AIzaSyBPmJ-QYXZ41gx-4PjCpUPuw7DLnDq0JFg",
authDomain:"venux1.firebaseapp.com",
projectId:"venux1",
storageBucket:"venux1.appspot.com",
messagingSenderId:"231055963335",
appId:"1:231055963335:web:34c2f52fca2191b3d0bae2"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const urlParams = new URLSearchParams(window.location.search);
const itemId = urlParams.get("id");
const notice = document.getElementById("notice");
const pageContent = document.getElementById("page-content");

async function loadItem(){
  try{
    const itemSnap = await getDoc(doc(db,"catalog",itemId));
    if(!itemSnap.exists()){ notice.textContent="Item not found"; return; }
    const item = itemSnap.data();
    notice.textContent="";

    pageContent.innerHTML=`
      <div class="item-view">
        <img src="${item.image}" alt="${item.name}">
        <div class="item-info">
          <h2>${item.name}</h2>
          <p><b>Price:</b> ${item.price} dosh</p>
          <p>${item.description}</p>
          <button id="buyBtn">Buy</button>
        </div>
      </div>
    `;

    const buyBtn = document.getElementById("buyBtn");
    onAuthStateChanged(auth, async user=>{
      if(!user){ buyBtn.disabled=true; buyBtn.textContent="Log in to buy"; return; }
      buyBtn.addEventListener("click", async ()=>{
        const userRef = doc(db,"users",user.uid);
        const userDoc = await getDoc(userRef);
        if(!userDoc.exists()) return alert("User not found");
        const inventory = userDoc.data().inventory;
        const typeMap = { hat:"hats", shirt:"shirts", pants:"pants", accessory:"accessorys" };
        const typeKey = typeMap[item.type];
        if(!inventory[typeKey]) inventory[typeKey] = [];
        if(inventory[typeKey].includes(itemId)) return alert("Already owned!");
        inventory[typeKey].push(itemId);
        await updateDoc(userRef,{inventory});
        alert("Item purchased!");
      });
    });

  }catch(err){console.error(err); notice.textContent="Failed to load item";}
}
loadItem();
</script>
</body>
</html>
