<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Venux - Profile</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #d4d4d4;
    color: #222;
    font-size: 13px;
  }

  /* Header */
  #main-header {
    background: linear-gradient(to bottom, #1a4a84 0%, #0b2c5a 100%);
    padding: 10px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  #main-header img {
    height: 52px;
  }
  .auth-buttons {
    display: flex;
    align-items: center;
    gap: 10px;
    color: white;
  }
  .logout-btn {
    padding: 8px 15px;
    border: none;
    border-radius: 4px;
    font-weight: bold;
    cursor: pointer;
    font-size: 12px;
    background: linear-gradient(to bottom, #f44336 0%, #da190b 100%);
    color: white;
    transition: 0.3s;
  }
  .logout-btn:hover {
    background: linear-gradient(to bottom, #da190b 0%, #f44336 100%);
  }

  /* Sub-header with | separators */
  #sub-header {
    background: linear-gradient(to bottom, #1a4a84 0%, #0b2c5a 100%);
    padding: 8px 15px;
    border-bottom: 1px solid #000;
    color: white;
  }
  #sub-header a {
    color: white;
    text-decoration: none;
    font-weight: bold;
  }
  #sub-header a:hover {
    text-decoration: underline;
  }
  .nav-separator {
    margin: 0 10px;
    color: white;
  }

  /* Notice bar */
  #notice {
    background: linear-gradient(to bottom, #ffa200 0%, #cc7a00 100%);
    color: white;
    padding: 10px 20px;
    font-weight: bold;
    text-align: center;
    border-bottom: 2px solid #a85f00;
  }

  /* Page content */
  #page-content {
    padding: 20px;
  }
  .profile-header {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 20px;
  }
  .avatar-placeholder {
    width: 80px;
    height: 80px;
    background: #ccc;
    border: 2px solid #999;
  }
  .profile-username {
    font-weight: bold;
    font-size: 20px;
  }
  #description {
    margin-bottom: 20px;
  }
  #badges {
    margin-top: 20px;
  }
  .badge {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 5px 10px;
    background: #1a4a84;
    color: white;
    border-radius: 4px;
    margin-right: 5px;
    font-size: 12px;
  }
  .badge img {
    width: 16px;
    height: 16px;
  }
  .edit-btn {
    margin-left: 10px;
    padding: 4px 8px;
    font-size: 12px;
    cursor: pointer;
  }
  textarea {
    width: 100%;
    padding: 8px;
    font-size: 13px;
    border: 1px solid #999;
    border-radius: 4px;
  }
  #saveDescription {
    margin-top: 8px;
    padding: 6px 12px;
    font-weight: bold;
    border: none;
    border-radius: 4px;
    background: linear-gradient(to bottom, #1a4a84 0%, #0b2c5a 100%);
    color: white;
    cursor: pointer;
    transition: 0.3s;
  }
  #saveDescription:hover {
    background: linear-gradient(to bottom, #255da3 0%, #0d3268 100%);
  }

  /* Footer */
  #footer {
    text-align: center;
    font-size: 12px;
    color: #444;
    padding: 10px;
    border-top: 2px solid #999;
    background: linear-gradient(to bottom, #f3f3f3 0%, #d8d8d8 100%);
    margin-top: 40px;
  }
</style>
</head>
<body>

<!-- Main Header -->
<div id="main-header">
  <img src="https://raw.githubusercontent.com/ayytrix/ventest1/refs/heads/main/venux.png" alt="Venux">
  <div class="auth-buttons" id="authButtons"></div>
</div>

<!-- Sub-header with special buttons -->
<div id="sub-header">
  <a href="Home.html">Home</a><span class="nav-separator">|</span>
  <a href="Games.html">Games</a><span class="nav-separator">|</span>
  <a href="Catalog.html">Catalog</a><span class="nav-separator">|</span>
  <a href="Users.html">Users</a><span class="nav-separator">|</span>
  <a href="Forums.html">Forum</a><span class="nav-separator">|</span>
  <a href="Clans.html">Clans</a><span class="nav-separator">|</span>
  <a href="Help.html">Help</a><span class="nav-separator">|</span>
  <a href="Downloads.html">Downloads</a><span class="nav-separator">|</span>
  <a href="Create.html">Create</a>
</div>

<!-- Notice Bar -->
<div id="notice">Loading...</div>

<!-- Profile Content -->
<div id="page-content">
  <div class="profile-header">
    <div class="avatar-placeholder"></div>
    <div class="profile-username" id="profileUsername"></div>
  </div>
  <div id="description"></div>
  <div id="badges"><strong>Player Badges:</strong> <span id="badgeContainer"></span></div>
</div>

<div id="footer">Â© 2025, Venux All rights reserved</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
import { getFirestore, collection, query, where, getDocs, setDoc, doc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBPmJ-QYXZ41gx-4PjCpUPuw7DLnDq0JFg",
  authDomain: "venux1.firebaseapp.com",
  projectId: "venux1",
  storageBucket: "venux1.appspot.com",
  messagingSenderId: "231055963335",
  appId: "1:231055963335:web:34c2f52fca2191b3d0bae2",
  measurementId: "G-N36RRV95SW"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const authButtons = document.getElementById("authButtons");
const noticeBar = document.getElementById("notice");
const profileUsername = document.getElementById("profileUsername");
const descriptionDiv = document.getElementById("description");
const badgeContainer = document.getElementById("badgeContainer");

// Fetch dynamic notice
fetch("https://raw.githubusercontent.com/ayytrix/ventest1/refs/heads/main/anc")
  .then(r => r.ok ? r.text() : "Welcome to Venux!")
  .then(t => noticeBar.textContent = t)
  .catch(() => noticeBar.textContent = "Welcome to Venux!");

// Get userId from URL
const urlParams = new URLSearchParams(window.location.search);
const viewingUserId = parseInt(urlParams.get('userId'), 10);

// Get user by numeric ID
async function getUserByNumericId(userId) {
  const usersRef = collection(db, "users");
  const q = query(usersRef, where("userId", "==", userId));
  const snapshot = await getDocs(q);
  if (!snapshot.empty) return snapshot.docs[0];
  return null;
}

// Auth state
onAuthStateChanged(auth, async (user) => {
  if (!user) {
    window.location.href = "Login.html";
    return;
  }

  // Logout button
  authButtons.innerHTML = `<button class="logout-btn" id="logoutBtn">Logout</button>`;
  document.getElementById("logoutBtn").addEventListener("click", async () => {
    await signOut(auth);
    window.location.href = "Login.html";
  });

  // Load profile
  let userDoc;
  if (viewingUserId) {
    userDoc = await getUserByNumericId(viewingUserId);
    if (!userDoc) {
      noticeBar.textContent = "User not found.";
      return;
    }
  } else {
    const ownUid = user.uid;
    const usersRef = collection(db, "users");
    const q = query(usersRef, where("uid", "==", ownUid));
    const snapshot = await getDocs(q);
    if (snapshot.empty) {
      noticeBar.textContent = "Profile not found.";
      return;
    }
    userDoc = snapshot.docs[0];
  }

  const data = userDoc.data();
  profileUsername.textContent = data.username || "User";

  // Description
  let descText = data.description || "This user hasn't added a description yet.";
  descriptionDiv.innerHTML = `<p id="descText">${descText}</p>`;

  // Edit own profile
  if (user.uid === userDoc.id) {
    const editBtn = document.createElement("button");
    editBtn.textContent = "Edit";
    editBtn.className = "edit-btn";
    descriptionDiv.appendChild(editBtn);

    editBtn.addEventListener("click", () => {
      const currentText = data.description || "";
      descriptionDiv.innerHTML = `<textarea id="descTextarea">${currentText}</textarea>
        <button id="saveDescription">Save</button>`;
      document.getElementById("saveDescription").addEventListener("click", async () => {
        const newDesc = document.getElementById("descTextarea").value;
        await setDoc(doc(db, "users", user.uid), { ...data, description: newDesc }, { merge: true });
        descriptionDiv.innerHTML = `<p id="descText">${newDesc}</p><button class="edit-btn">Edit</button>`;
      });
    });
  }

  // Badges with icons
  badgeContainer.innerHTML = "";
  const badgeIcons = {
    "Admin Badge": "https://raw.githubusercontent.com/ayytrix/ventest1/refs/heads/main/developer-removebg-preview.png",
    "Special Badge": "https://i.imgur.com/3LxXo4S.png",
    "VIP Badge": "https://i.imgur.com/4dK7XqE.png"
  };
  const userBadges = data.badges || [];
  userBadges.forEach(badgeName => {
    const badge = document.createElement("span");
    badge.className = "badge";
    if (badgeIcons[badgeName]) {
      const img = document.createElement("img");
      img.src = badgeIcons[badgeName];
      img.alt = badgeName;
      badge.appendChild(img);
    }
    badge.appendChild(document.createTextNode(badgeName));
    badgeContainer.appendChild(badge);
  });
});
</script>

</body>
</html>
