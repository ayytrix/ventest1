<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Venux - Sign Up</title>
  <style>
    body { margin:0; font-family:Arial,sans-serif; background:#d4d4d4; color:#222; font-size:13px;}
    #main-header { background: linear-gradient(to bottom,#1a4a84 0%,#0b2c5a 100%); padding:10px 20px; border-bottom:2px solid #071b36;}
    #main-header img { height:52px; object-fit:contain;}
    #page-content { padding:40px; display:flex; justify-content:center;}
    .signup-box { background: #fff; border:2px solid #999; box-shadow:2px 2px 0 #aaa; padding:25px 35px; width:420px; border-radius:6px;}
    .signup-box h2 { text-align:center; font-size:16px; margin-bottom:20px; border-bottom:1px solid #aaa; padding-bottom:8px;}
    .signup-box label { display:block; font-weight:bold; margin-bottom:5px;}
    .signup-box input { width:100%; padding:8px; margin-bottom:10px; border:1px solid #999; border-radius:3px; font-size:13px;}
    .signup-box button { width:100%; padding:10px; background: linear-gradient(to bottom,#1a4a84 0%,#0b2c5a 100%); color:white; border:none; border-radius:4px; font-weight:bold; cursor:pointer; margin-top:10px;}
    .signup-box button:hover { background: linear-gradient(to bottom,#255da3 0%,#0d3268 100%);}
    .error-message { color:red; font-size:12px; margin-top:-5px; margin-bottom:10px; display:none;}
    .success-message { color:green; font-size:12px; margin-top:-5px; margin-bottom:10px; display:none;}
    #footer { text-align:center; font-size:12px; color:#444; padding:10px; border-top:2px solid #999; background: linear-gradient(to bottom,#f3f3f3 0%,#d8d8d8 100%); margin-top:40px;}
  </style>
</head>
<body>

<div id="main-header">
  <img src="https://raw.githubusercontent.com/ayytrix/ventest1/refs/heads/main/venux.png" alt="Venux">
</div>

<div id="page-content">
  <div class="signup-box">
    <h2>Sign Up</h2>
    <form id="signupForm">
      <label for="username">Username</label>
      <input type="text" id="username" name="username" placeholder="Choose a username" required>
      <div id="usernameError" class="error-message"></div>

      <label for="password">Password</label>
      <input type="password" id="password" name="password" placeholder="Create a password" required>
      <label for="confirm-password">Confirm Password</label>
      <input type="password" id="confirm-password" name="confirm-password" placeholder="Re-enter your password" required>
      <div id="passwordError" class="error-message"></div>
      <div id="passwordSuccess" class="success-message">Passwords match!</div>

      <button type="submit" id="signupBtn">Create Account</button>
    </form>
  </div>
</div>

<div id="footer">
  Â© 2025, Venux All rights reserved
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
import { getFirestore, doc, setDoc, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBPmJ-QYXZ41gx-4PjCpUPuw7DLnDq0JFg",
  authDomain: "venux1.firebaseapp.com",
  projectId: "venux1",
  storageBucket: "venux1.appspot.com",
  messagingSenderId: "231055963335",
  appId: "1:231055963335:web:34c2f52fca2191b3d0bae2",
  measurementId: "G-N36RRV95SW"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const form = document.getElementById("signupForm");
const usernameInput = document.getElementById("username");
const passwordInput = document.getElementById("password");
const confirmPassword = document.getElementById("confirm-password");
const usernameError = document.getElementById("usernameError");
const passwordError = document.getElementById("passwordError");
const passwordSuccess = document.getElementById("passwordSuccess");
const signupBtn = document.getElementById("signupBtn");

// Check username availability
async function checkUsernameAvailability(username){
  const usersRef = collection(db,"users");
  const q = query(usersRef,where("username","==",username));
  const snapshot = await getDocs(q);
  return snapshot.empty;
}

// Check passwords
function checkPasswords(){
  if(passwordInput.value.length<6){
    passwordError.style.display="block";
    passwordError.textContent="Password must be at least 6 characters";
    passwordSuccess.style.display="none";
    return false;
  }
  if(passwordInput.value !== confirmPassword.value){
    passwordError.style.display="block";
    passwordError.textContent="Passwords do not match";
    passwordSuccess.style.display="none";
    return false;
  }
  passwordError.style.display="none";
  passwordSuccess.style.display="block";
  return true;
}

passwordInput.addEventListener("input",checkPasswords);
confirmPassword.addEventListener("input",checkPasswords);

form.addEventListener("submit",async (e)=>{
  e.preventDefault();
  if(!checkPasswords()) return;

  const username = usernameInput.value.trim();
  const isAvailable = await checkUsernameAvailability(username);
  if(!isAvailable){
    usernameError.style.display="block";
    usernameError.textContent="Username already taken";
    return;
  }

  const uniqueEmail = `${username.toLowerCase().replace(/[^a-z0-9]/g,'')}_${Date.now()}@example.com`;
  signupBtn.disabled = true;
  signupBtn.textContent = "Creating Account...";

  try{
    const userCredential = await createUserWithEmailAndPassword(auth,uniqueEmail,passwordInput.value);
    const user = userCredential.user;

    // Save user info in Firestore
    await setDoc(doc(db,"users",user.uid),{
      username: username,
      authEmail: uniqueEmail,
      createdAt: new Date().toISOString()
    });

    window.location.href = "Home.html";
  }catch(err){
    alert("Error: "+err.message);
    signupBtn.disabled=false;
    signupBtn.textContent="Create Account";
  }
});
</script>

</body>
</html>
